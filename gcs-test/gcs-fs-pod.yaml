apiVersion: apps/v1beta1
kind: Deployment
metadata:
  name: gcs-fs-deployment
spec:
  replicas: 2 # tells deployment to run 2 pods matching the template
  template: # create pods using pod definition in this template
    metadata:
    labels:
        app: gcs-fs-service
    spec:
    containers:
    - name: gcs-fs
      securityContext:
        privileged: true
        capabilities:
          add:
            - SYS_ADMIN
      image: sgsg-dm/gcs-fs
      ports:
      - containerPort: 8080
      lifecycle:
        postStart:
          exec:
            command: ["gcsfuse", "-o", "nonempty", "sgsg-dm-fs", "/etc/app_folder"]
        preStop:
          exec:
            command: ["fusermount", "-u", "/etc/app_folder"]